<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 50%;
      }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

  </head>
  <body>
    <div id="map"></div>
    <div id="compost_data"></div>
    <script>
	var x = document.getElementById("compost_data");
     var current_iw = null;

	function getLocation() {
	    if (navigator.geolocation) {
	        navigator.geolocation.getCurrentPosition(showPosition);
	    } else {
	        x.innerHTML = "Geolocation is not supported by this browser.";
	    }
	}

	function showPosition(position) {
    		x.innerHTML = "Latitude: " + position.coords.latitude + "<br>Longitude: " + position.coords.longitude; 
	}

      var map;
      function initMap() {

        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 23.4, lng: 34.2},
          zoom: 8
        });
       

        //0
        var ready_to_take_image_icon = 'http://www.megaicons.net/static/img/icons_sizes/401/1203/32/dumpster-diving-icon.png';
        //2
        var ready_to_put_image = 'http://www.megaicons.net/static/img/icons_sizes/486/2080/32/system-recycle-bin-empty-icon.png';
        //1            
        var do_not_touch_image = 'http://www.tkdocs.com/images/closeicon.png';


	function addMarkers(composter) {
            var cur_icon = '';
           console.log(composter);
            if (composter.composter_status == 0){
                cur_icon = ready_to_take_image_icon
            } else if (composter.composter_status == 1){
                cur_icon = do_not_touch_image;
            } else {
                cur_icon = ready_to_put_image;
            }

/*
            var image = {
                url: cur_icon,
                // This marker is 20 pixels wide by 32 pixels high.
                size: new google.maps.Size(32, 32),
                // The origin for this image is (0, 0).
                origin: new google.maps.Point(0, 0),
                // The anchor for this image is the base of the flagpole at (0, 32).
                anchor: new google.maps.Point(0, 32)
              };
*/
        	var m = new google.maps.Marker({
        	    	position: {lat: composter.lat,lng:composter.lon},
        	    	map: map,
        	    	title: 'Composter',
                icon: cur_icon
        		});
        		var constr = '<div id="content"><p>' + composter.description + '</p></dev>'
        	var iw = new google.maps.InfoWindow({content : constr });
		m.addListener('click',function() {
                if (current_iw != null)
                {
                    current_iw.close();
                }
			iw.open(map,m);
                current_iw = iw;
                compost_data_html = '<div id="compost_info">'
                compost_data_html += '<div id="description"><b>Description:</b><p>' +  composter.description +' </p></div>'
                compost_data_html += '<div id="temp"><b>Temperature:</b><p>' +  composter.temp +' </p></div>'
                compost_data_html += '<div id="humidity"><b>humidity:</b><p>' +  composter.humidity +' </p></div>'
                compost_data_html += '<div id="weight"><b>weight:</b><p>' +  composter.weight +' </p></div>'
                compost_data_html += '<div id="door_status"><b>door status:</b><p>' +  composter.door_status +' </p></div>'
                compost_data_html += '<div id="compost_status"><b>compost status:</b><p>' +  composter.composter_status +' </p></div>'
                compost_data_html += '</div>'

                $("#compost_data").html(compost_data_html)

		});

	}

    	$.getJSON('getCompostersJson', function(result){
		result.forEach(addMarkers);
    	});
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUvY8G486XWmgJG-3c0SbIwDC27h4Hnio&callback=initMap" async defer></script>
    
  </body>
</html>
