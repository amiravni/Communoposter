<html>

<head>
  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

<style>
table {
    border-collapse: collapse;
    width: 50%;
}

th, td {
    padding: 8px;
    text-align: left;
    border-bottom: 1px solid #ddd;
    border-right: 1px solid #ddd;
}

tr:hover{background-color:#f5f5f5}
</style>

</head>

<body>

  <table>
  <tr style="border-bottom: 1px solid #ddd;">
    <td></td>
    <td><b>Temp (cels)</b></td>
    <td><b>Humidity (%)</b></td>
    <td></td>
  </tr>
  <tr  id="level1">
    <td><b>Level 1</b></td>
    <td> <div id="temp1" style="width: 100px; height: 150px;"></div></td>
    <td><div id="humidity1" style="width: 100px; height: 150px;"></div></td>
    <td><div id="fusion1">Fusion</div></td>
  </tr>
  <tr id="level2">
    <td><b>Level 2</b></td>
    <td> <div id="temp2" style="width: 100px; height: 150px;"></div></td>
    <td><div id="humidity2" style="width: 100px; height: 150px;"></div></td>
    <td><div id="fusion2">Fusion</div></td>
  </tr>
  <tr id="level3">
    <td><b>Level 3</b></td>
    <td> <div id="temp3" style="width: 100px; height: 150px;"></div></td>
    <td><div id="humidity3" style="width: 100px; height: 150px;"></div></td>
    <td><div id="fusion3">Fusion</div></td>
  </tr>
  <tr id="level4">
    <td><b>Level 4</b></td>
    <td> <div id="temp4" style="width: 100px; height: 150px;"></div></td>
    <td><div id="humidity4" style="width: 100px; height: 150px;"></div></td>
    <td><div id="fusion4">Fusion</div></td>
  </tr>


  <script>

    var queryDict = {}
    location.search.substr(1).split("&").forEach(function(item) {queryDict[item.split("=")[0]] = item.split("=")[1]})
    
    console.log(queryDict.id)

    function getData()
    {
        var time = [];
    
        var index = [];
    
        var temp1 = [];
        var temp2 = [];
        var temp3 = [];
        var temp4 = [];
    
        var humidity1 = [];
        var humidity2 = [];
        var humidity3 = [];
        var humidity4 = [];
    
        var dist1 = [];
        var dist2 = [];
        var dist3 = [];
        var dist4 = [];
    
        function collect_data(reading_data)
        {    
            time[time.length] = reading_data.time;
            index[index.length] = index.length;
    
            temp1[temp1.length] = reading_data.temp[0];
            temp2[temp2.length] = reading_data.temp[1];
            temp3[temp3.length] = reading_data.temp[2];
            temp4[temp4.length] = reading_data.temp[3];
    
            humidity1[humidity1.length] = reading_data.humidity[0];
            humidity2[humidity2.length] = reading_data.humidity[1];
            humidity3[humidity3.length] = reading_data.humidity[2];
            humidity4[humidity4.length] = reading_data.humidity[3];
    
            dist1[dist1.length] = reading_data.dist[0];
            dist2[dist2.length] = reading_data.dist[1];
            dist3[dist3.length] = reading_data.dist[2];
            dist4[dist4.length] = reading_data.dist[3];
    
        }
    
    
    	$.getJSON('getCompostReadings?id='+queryDict.id, function(result){
		result.forEach(collect_data);
            plotData();
    	});
    
    function plotData()
    {
    	var temp1_plot = {
    	  x: index, 
    	  y: temp1, 
    	  type: 'scatter',
    	};
    
    	var temp2_plot = {
    	  x: index, 
    	  y: temp2, 
    	  type: 'scatter',

    	};
    
    	var temp3_plot = {
    	  x: index, 
    	  y: temp3, 
    	  type: 'scatter',

    	};
    
    	var temp4_plot = {
    	  x: index, 
    	  y: temp4, 
    	  type: 'scatter',

    	};
    
    
    	var humidity1_plot = {
    	  x: index, 
    	  y: humidity1, 
    	  type: 'scatter'
    	};
    
    	var humidity2_plot = {
    	  x: index, 
    	  y: humidity2, 
    	  type: 'scatter',

    	};
    
    	var humidity3_plot = {
    	  x: index, 
    	  y: humidity3, 
    	  type: 'scatter',
    	};
    
    	var humidity4_plot = {
    	  x: index, 
    	  y: humidity4, 
    	  type: 'scatter',
    	};
    
    
        var single_red_layout = {
          autosize: false,
          width: 150,
          height: 150,
          margin: {
            l: 20,
            r: 20,
            b: 20,
            t: 20,
            pad: 0
          },
          paper_bgcolor: '#ff0000',
          plot_bgcolor: '#ff0000'
        }
        var single_green_layout = {
          autosize: false,
          width: 150,
          height: 150,
          margin: {
            l: 20,
            r: 20,
            b: 20,
            t: 20,
            pad: 0
          },
          paper_bgcolor: '#ffffff',
          plot_bgcolor: '#ffffff'
        }


            if (dist1[dist1.length-1] > 100) 
            {
                $('#level1').css('background-color','#ff0000')
                Plotly.newPlot('temp1', [temp1_plot],single_red_layout);
                Plotly.newPlot('humidity1', [humidity1_plot],single_red_layout);

            } else {
                $('#level1').css('background-color','#ffffff')
                Plotly.newPlot('temp1', [temp1_plot],single_green_layout);
                Plotly.newPlot('humidity1', [humidity1_plot],single_green_layout);
            }

            if (dist2[dist2.length-1] > 100) 
            {
                $('#level2').css('background-color','#ff0000')
                Plotly.newPlot('temp2', [temp2_plot],single_red_layout);
                Plotly.newPlot('humidity2', [humidity2_plot],single_red_layout);

            } else {
                $('#level2').css('background-color','#ffffff')
                Plotly.newPlot('temp2', [temp2_plot],single_green_layout);
                Plotly.newPlot('humidity2', [humidity2_plot],single_green_layout);
            }

            if (dist1[dist3.length-1] > 100) 
            {
                $('#level3').css('background-color','#ff0000')
                Plotly.newPlot('temp3', [temp3_plot],single_red_layout);
                Plotly.newPlot('humidity3', [humidity3_plot],single_red_layout);

            } else {
                $('#level3').css('background-color','#ffffff')
                Plotly.newPlot('temp3', [temp3_plot],single_green_layout);
                Plotly.newPlot('humidity3', [humidity3_plot],single_green_layout);
            }

            if (dist4[dist4.length-1] > 100) 
            {
                $('#level4').css('background-color','#ff0000')
                Plotly.newPlot('temp4', [temp4_plot],single_red_layout);
                Plotly.newPlot('humidity4', [humidity4_plot],single_red_layout);

            } else {
                $('#level4').css('background-color','#ffffff')
                Plotly.newPlot('temp4', [temp4_plot],single_green_layout);
                Plotly.newPlot('humidity4', [humidity4_plot],single_green_layout);
            }
    }


    }
    getData();
    var t=setInterval(getData,5000);

  </script>
</body>

</html>
