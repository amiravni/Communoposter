<html>

<head>
  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

</head>

<body>

  <table>
  <tr  id="level1">
    <td> <div id="temp1" style="width: 300px; height: 300px;"></div></td>
    <td><div id="humidity1" style="width: 300px; height: 300px;"></div></td>
    <td><div id="fusion1">Fusion</div></td>
  </tr>
  <tr id="level2">
    <td> <div id="temp2" style="width: 300px; height: 300px;"></div></td>
    <td><div id="humidity2" style="width: 300px; height: 300px;"></div></td>
    <td><div id="fusion2">Fusion</div></td>
  </tr>
  <tr id="level3">
    <td> <div id="temp3" style="width: 300px; height: 300px;"></div></td>
    <td><div id="humidity3" style="width: 300px; height: 300px;"></div></td>
    <td><div id="fusion3">Fusion</div></td>
  </tr>
  <tr id="level4">
    <td> <div id="temp4" style="width: 300px; height: 300px;"></div></td>
    <td><div id="humidity4" style="width: 300px; height: 300px;"></div></td>
    <td><div id="fusion4">Fusion</div></td>
  </tr>


  <script>

    var queryDict = {}
    location.search.substr(1).split("&").forEach(function(item) {queryDict[item.split("=")[0]] = item.split("=")[1]})
    
    console.log(queryDict.id)

    function getData()
    {
        var time = [];
    
        var index = [];
    
        var temp1 = [];
        var temp2 = [];
        var temp3 = [];
        var temp4 = [];
    
        var humidity1 = [];
        var humidity2 = [];
        var humidity3 = [];
        var humidity4 = [];
    
        var dist1 = [];
        var dist2 = [];
        var dist3 = [];
        var dist4 = [];
    
        function collect_data(reading_data)
        {    
            time[time.length] = reading_data.time;
            index[index.length] = index.length;
    
            temp1[temp1.length] = reading_data.temp[0];
            temp2[temp2.length] = reading_data.temp[1];
            temp3[temp3.length] = reading_data.temp[2];
            temp4[temp4.length] = reading_data.temp[3];
    
            humidity1[humidity1.length] = reading_data.humidity[0];
            humidity2[humidity2.length] = reading_data.humidity[1];
            humidity3[humidity3.length] = reading_data.humidity[2];
            humidity4[humidity4.length] = reading_data.humidity[3];
    
            dist1[dist1.length] = reading_data.dist[0];
            dist2[dist2.length] = reading_data.dist[1];
            dist3[dist3.length] = reading_data.dist[2];
            dist4[dist4.length] = reading_data.dist[3];
    
        }
    
    
    	$.getJSON('getCompostReadings?id='+queryDict.id, function(result){
		result.forEach(collect_data);
            plotData();
    	});
    
    function plotData()
    {
    	var temp1_plot = {
    	  x: index, 
    	  y: temp1, 
    	  type: 'scatter',
    	};
    
    	var temp2_plot = {
    	  x: index, 
    	  y: temp2, 
    	  type: 'scatter',
            xaxis: 'x2',
            yaxis: 'y2'
    	};
    
    	var temp3_plot = {
    	  x: index, 
    	  y: temp3, 
    	  type: 'scatter',
            xaxis: 'x3',
            yaxis: 'y3'
    	};
    
    	var temp4_plot = {
    	  x: index, 
    	  y: temp4, 
    	  type: 'scatter',
            xaxis: 'x4',
            yaxis: 'y4'
    	};
    
    
    	var humidity1_plot = {
    	  x: index, 
    	  y: humidity1, 
    	  type: 'scatter'
    	};
    
    	var humidity2_plot = {
    	  x: index, 
    	  y: humidity2, 
    	  type: 'scatter',
            xaxis: 'x2',
            yaxis: 'y2'
    	};
    
    	var humidity3_plot = {
    	  x: index, 
    	  y: humidity3, 
    	  type: 'scatter',
            xaxis: 'x3',
            yaxis: 'y3'
    	};
    
    	var humidity4_plot = {
    	  x: index, 
    	  y: humidity4, 
    	  type: 'scatter',
            xaxis: 'x4',
            yaxis: 'y4'
    	};
    
    

            var layout = {
              xaxis: {domain: [0, 0.20]},
              yaxis2: {anchor: 'x2'},
              xaxis2: {domain: [0.25, 0.45]},
              yaxis3: {anchor: 'x3'},
              xaxis3: {domain: [0.50, 0.70]},
              yaxis4: {anchor: 'x4'},
              xaxis4: {domain: [0.75, 1]},
            };

            var layout2 = {
              xaxis: {domain: [0, 0.20]},
              yaxis: {range: [20,70]},
              yaxis2: {anchor: 'x2',range: [20,70]},
              xaxis2: {domain: [0.25, 0.45]},
              yaxis3: {anchor: 'x3',range: [20,70]},
              xaxis3: {domain: [0.50, 0.70]},
              yaxis4: {anchor: 'x4',range: [20,70]},
              xaxis4: {domain: [0.75, 1]},
            };
    
            Plotly.newPlot('temp1', [temp1_plot]);
            Plotly.newPlot('temp2', [temp2_plot]);
            Plotly.newPlot('temp3', [temp3_plot]);
            Plotly.newPlot('temp4', [temp4_plot]);
            Plotly.newPlot('humidity1', [humidity1_plot]);
            Plotly.newPlot('humidity2', [humidity2_plot]);
            Plotly.newPlot('humidity3', [humidity3_plot]);
            Plotly.newPlot('humidity4', [humidity4_plot]);

            if (dist1[dist1.length-1] > 100) 
            {
                $('#level1').css('background-color','#ff0000')
            }
            if (dist2[dist2.length-1] > 100) 
            {
                $('#level2').css('background-color','#ff0000')
            }
            if (dist3[dist3.length-1] > 100) 
            {
                $('#level3').css('background-color','#ff0000')
            }
            if (dist4[dist4.length-1] > 100) 
            {
                $('#level4').css('background-color','#ff0000')
            }
    }


    }
    getData();
    var t=setInterval(getData,5000);

  </script>
</body>

</html>
